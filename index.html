<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RN Studio - Business Manager</title>
 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(20, 20, 20, 0.8);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .header {
            text-align: center;
            margin-bottom: 48px;
            position: relative;
        }

        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .header h1::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            filter: blur(20px);
            opacity: 0.3;
            z-index: -1;
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        /* Mobile Navigation */
        .mobile-nav-toggle {
            display: none;
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .mobile-nav-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .hamburger {
            width: 24px;
            height: 24px;
            position: relative;
        }

        .hamburger span {
            display: block;
            width: 100%;
            height: 2px;
            background: white;
            border-radius: 1px;
            position: absolute;
            transition: all 0.3s ease;
        }

        .hamburger span:nth-child(1) { top: 6px; }
        .hamburger span:nth-child(2) { top: 12px; }
        .hamburger span:nth-child(3) { top: 18px; }

        .mobile-nav-toggle.active .hamburger span:nth-child(1) {
            transform: rotate(45deg);
            top: 12px;
        }

        .mobile-nav-toggle.active .hamburger span:nth-child(2) {
            opacity: 0;
        }

        .mobile-nav-toggle.active .hamburger span:nth-child(3) {
            transform: rotate(-45deg);
            top: 12px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .nav-tab {
            padding: 14px 24px;
            background: transparent;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: rgba(255, 255, 255, 0.7);
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 
                0 8px 32px rgba(102, 126, 234, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        /* Mobile Navigation Styles */
        @media (max-width: 768px) {
            .mobile-nav-toggle {
                display: block;
            }

            .nav-tabs {
                position: fixed;
                top: 0;
                right: -100%;
                width: 280px;
                height: 100vh;
                background: rgba(20, 20, 20, 0.95);
                backdrop-filter: blur(20px);
                flex-direction: column;
                justify-content: flex-start;
                padding: 80px 20px 20px;
                margin: 0;
                border-radius: 0;
                border-left: 1px solid rgba(255, 255, 255, 0.1);
                transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 999;
                overflow-y: auto;
            }

            .nav-tabs.mobile-open {
                right: 0;
            }

            .nav-tab {
                width: 100%;
                text-align: left;
                padding: 16px 20px;
                margin: 4px 0;
                border-radius: 12px;
                font-size: 1rem;
            }

            .container {
                padding: 20px;
                margin-top: 60px;
            }
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .form-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 32px;
            border-radius: 20px;
            margin-bottom: 32px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .form-section h3 {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 24px;
            font-size: 1.5rem;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            position: relative;
            padding-bottom: 12px;
        }

        .form-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            transform: translateY(-1px);
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: none;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            box-shadow: 0 8px 32px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(255, 107, 107, 0.4);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .data-table th,
        .data-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.9);
        }

        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 32px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .stat-card h4 {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            font-family: 'Poppins', sans-serif;
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .google-sheets-section {
            background: rgba(102, 126, 234, 0.1);
            padding: 24px;
            border-radius: 16px;
            margin-top: 24px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            backdrop-filter: blur(10px);
        }

        .google-sheets-section h4 {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 16px;
            font-weight: 600;
        }

        .status-indicator {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-connected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .expense-breakdown-grid {
            display: grid;
            gap: 20px;
            margin-top: 24px;
        }

        .expense-category {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .category-name {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .category-amount {
            color: #667eea;
            font-weight: 600;
        }

        .category-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .category-progress {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .category-percentage {
            text-align: right;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .table-responsive {
            overflow-x: auto;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .table-responsive table {
            min-width: 100%;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
        }

        .warning-box h5 {
            color: #f59e0b;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .warning-box p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .sync-options {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .footer {
            text-align: center;
            margin-top: 48px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .table-responsive {
                font-size: 0.9rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 12px 8px;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Additional modern touches */
        .form-section, .stat-card {
            transition: all 0.3s ease;
        }

        .form-section:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }

        /* Mobile overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-overlay.active {
            display: block;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .header p {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="mobile-nav-toggle" onclick="toggleMobileNav()">
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </button>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeMobileNav()"></div>

    <div class="container">
        <div class="header">
            <h1>RN Studio</h1>
            <p>Professional Photography Business Manager</p>
        </div>

        <div class="nav-tabs" id="navTabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="showTab('add-event')">Add Event</button>
            <button class="nav-tab" onclick="showTab('events')">View Events</button>
            <button class="nav-tab" onclick="showTab('photographers')">Photographers</button>
            <button class="nav-tab" onclick="showTab('salary-management')">Salary Management</button>
            <button class="nav-tab" onclick="showTab('expense-tracker')">Expense Tracker</button>
            <button class="nav-tab" onclick="showTab('salary-dashboard')">Salary Dashboard</button>
            <button class="nav-tab" onclick="showTab('analytics')">Analytics</button>
            <button class="nav-tab" onclick="showTab('settings')">Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Total Events</h4>
                    <div class="value" id="totalEvents">0</div>
                </div>
                <div class="stat-card">
                    <h4>Total Revenue</h4>
                    <div class="value" id="totalRevenue">₹0</div>
                </div>
                <div class="stat-card">
                    <h4>Total Expenses</h4>
                    <div class="value" id="totalExpenses">₹0</div>
                </div>
                <div class="stat-card">
                    <h4>Net Profit</h4>
                    <div class="value" id="netProfit">₹0</div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Recent Events</h3>
                <div class="table-responsive">
                    <table class="data-table" id="recentEventsTable">
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>Date</th>
                                <th>Prize</th>
                                <th>Photographer</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentEventsBody">
                            <tr>
                                <td colspan="5" style="text-align: center; color: rgba(255, 255, 255, 0.5);">No events found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Add Event Tab -->
        <div id="add-event" class="tab-content">
            <div class="form-section">
                <h3>Add New Event</h3>
                <form id="eventForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="eventName">Event Name</label>
                            <input type="text" id="eventName" name="eventName" required>
                        </div>
                        <div class="form-group">
                            <label for="eventDate">Event Date</label>
                            <input type="date" id="eventDate" name="eventDate" required>
                        </div>
                        <div class="form-group">
                            <label for="eventPrize">Event Prize (₹)</label>
                            <input type="number" id="eventPrize" name="eventPrize" required>
                        </div>
                        <div class="form-group">
                            <label for="eventExpenses">Event Expenses (₹)</label>
                            <input type="number" id="eventExpenses" name="eventExpenses">
                        </div>
                        <div class="form-group">
                            <label for="photographerName">Photographer</label>
                            <select id="photographerName" name="photographerName" required>
                                <option value="">Select Photographer</option>
                                <option value="Self">Self</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="photographerSalary">Photographer Salary (₹)</label>
                            <input type="number" id="photographerSalary" name="photographerSalary">
                        </div>
                        <div class="form-group">
                            <label for="eventDuration">Event Duration (Days)</label>
                            <input type="number" id="eventDuration" name="eventDuration" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="eventType">Event Type</label>
                            <select id="eventType" name="eventType" required>
                                <option value="">Select Type</option>
                                <option value="Wedding">Wedding</option>
                                <option value="Pre-Wedding">Pre-Wedding</option>
                                <option value="Birthday">Birthday</option>
                                <option value="Corporate">Corporate</option>
                                <option value="Fashion">Fashion</option>
                                <option value="Portrait">Portrait</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="eventNotes">Notes</label>
                        <textarea id="eventNotes" name="eventNotes" rows="3" placeholder="Additional notes about the event..."></textarea>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-primary">Add Event</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- View Events Tab -->
        <div id="events" class="tab-content">
            <div class="form-section">
                <h3>All Events</h3>
                <div style="margin-bottom: 20px;">
                    <input type="text" id="searchEvents" placeholder="Search events..." style="padding: 10px; width: 300px; border: 1px solid #ddd; border-radius: 5px;">
                    <select id="filterType" style="padding: 10px; margin-left: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="">All Types</option>
                        <option value="Wedding">Wedding</option>
                        <option value="Pre-Wedding">Pre-Wedding</option>
                        <option value="Birthday">Birthday</option>
                        <option value="Corporate">Corporate</option>
                        <option value="Fashion">Fashion</option>
                        <option value="Portrait">Portrait</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <table class="data-table" id="eventsTable">
                    <thead>
                        <tr>
                            <th>Event Name</th>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Prize</th>
                            <th>Expenses</th>
                            <th>Photographer</th>
                            <th>Salary</th>
                            <th>Duration</th>
                            <th>Profit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="eventsTableBody">
                        <tr>
                            <td colspan="10" style="text-align: center; color: #666;">No events found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Photographers Tab -->
        <div id="photographers" class="tab-content">
            <div class="form-section">
                <h3>Add Photographer</h3>
                <form id="photographerForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="photographerNameAdd">Photographer Name</label>
                            <input type="text" id="photographerNameAdd" name="photographerNameAdd" required>
                        </div>
                        <div class="form-group">
                            <label for="photographerContact">Contact Number</label>
                            <input type="tel" id="photographerContact" name="photographerContact">
                        </div>
                        <div class="form-group">
                            <label for="photographerEmail">Email</label>
                            <input type="email" id="photographerEmail" name="photographerEmail">
                        </div>
                        <div class="form-group">
                            <label for="photographerRate">Daily Rate (₹)</label>
                            <input type="number" id="photographerRate" name="photographerRate">
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-primary">Add Photographer</button>
                    </div>
                </form>
            </div>
            
            <div class="form-section">
                <h3>Photographers List</h3>
                <table class="data-table" id="photographersTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Contact</th>
                            <th>Email</th>
                            <th>Daily Rate</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="photographersTableBody">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #666;">No photographers found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Average Event Value</h4>
                    <div class="value" id="avgEventValue">₹0</div>
                </div>
                <div class="stat-card">
                    <h4>This Month Revenue</h4>
                    <div class="value" id="monthRevenue">₹0</div>
                </div>
                <div class="stat-card">
                    <h4>Most Popular Event Type</h4>
                    <div class="value" id="popularEventType">-</div>
                </div>
                <div class="stat-card">
                    <h4>Total Event Days</h4>
                    <div class="value" id="totalEventDays">0</div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Monthly Revenue Analysis</h3>
                <canvas id="revenueChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="form-section">
                <h3>Google Sheets Integration</h3>
                <div class="google-sheets-section">
                    <h4>Connection Status: <span class="status-indicator status-disconnected" id="connectionStatus">Disconnected</span></h4>
                    
                    <div class="warning-box">
                        <h5>⚠️ Important Notice</h5>
                        <p>When connecting to Google Sheets for the first time, your local data will be preserved. The system will first upload your existing data to the sheet before enabling synchronization.</p>
                    </div>
                    
                    <p>To connect with Google Sheets, you'll need to:</p>
                    <ol>
                        <li>Create a Google Sheet for your business data</li>
                        <li>Set up Google Apps Script (copy the provided script)</li>
                        <li>Deploy as web app (Execute as: Me, Who has access: Anyone)</li>
                        <li>Enter the web app URL below</li>
                    </ol>
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="googleSheetUrl">Google Apps Script Web App URL</label>
                        <input type="url" id="googleSheetUrl" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
                    </div>
                    
                    <div class="sync-options">
                        <button class="btn btn-primary" onclick="connectGoogleSheets()">Connect & Upload Data</button>
                        <button class="btn btn-secondary" onclick="syncToGoogleSheets(true)" id="manualSyncBtn" disabled>Manual Sync</button>
                        <button class="btn btn-secondary" onclick="loadFromGoogleSheets()" id="loadFromSheetsBtn" disabled>Load from Sheets</button>
                        <button class="btn btn-danger" onclick="disconnectGoogleSheets()">Disconnect</button>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Data Management</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="exportData()">Export Data</button>
                    <button class="btn btn-secondary" onclick="importData()">Import Data</button>
                    <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
                </div>
            </div>
        </div>

        <div id="salary-management" class="tab-content">
    <div class="form-section">
        <h3>Photographer Attendance & Salary</h3>
        <form id="attendanceForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="attendancePhotographer">Photographer</label>
                    <select id="attendancePhotographer" name="attendancePhotographer" required>
                        <option value="">Select Photographer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="attendanceDate">Date</label>
                    <input type="date" id="attendanceDate" name="attendanceDate" required>
                </div>
                <div class="form-group">
                    <label for="attendanceStatus">Status</label>
                    <select id="attendanceStatus" name="attendanceStatus" required>
                        <option value="">Select Status</option>
                        <option value="Present">Present</option>
                        <option value="Absent">Absent</option>
                        <option value="Half-Day">Half-Day</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="attendanceNotes">Notes</label>
                    <input type="text" id="attendanceNotes" name="attendanceNotes" placeholder="Optional notes">
                </div>
            </div>
            <div class="action-buttons">
                <button type="submit" class="btn btn-primary">Mark Attendance</button>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('attendanceForm').reset()">Clear</button>
            </div>
        </form>
    </div>

    <div class="form-section">
        <h3>Salary Payment</h3>
        <form id="salaryPaymentForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="paymentPhotographer">Photographer</label>
                    <select id="paymentPhotographer" name="paymentPhotographer" required>
                        <option value="">Select Photographer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="paymentAmount">Payment Amount (₹)</label>
                    <input type="number" id="paymentAmount" name="paymentAmount" required>
                </div>
                <div class="form-group">
                    <label for="paymentDate">Payment Date</label>
                    <input type="date" id="paymentDate" name="paymentDate" required>
                </div>
                <div class="form-group">
                    <label for="paymentMode">Payment Mode</label>
                    <select id="paymentMode" name="paymentMode" required>
                        <option value="">Select Mode</option>
                        <option value="Cash">Cash</option>
                        <option value="UPI">UPI</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Cheque">Cheque</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="paymentRemarks">Remarks</label>
                    <input type="text" id="paymentRemarks" name="paymentRemarks" placeholder="Optional remarks">
                </div>
            </div>
            <div class="action-buttons">
                <button type="submit" class="btn btn-primary">Record Payment</button>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('salaryPaymentForm').reset()">Clear</button>
            </div>
        </form>
    </div>

    <div class="form-section">
        <h3>Attendance Records</h3>
        <div style="margin-bottom: 20px;">
            <select id="attendanceFilterPhotographer" style="padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <option value="">All Photographers</option>
            </select>
            <input type="month" id="attendanceFilterMonth" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
        </div>
        <table class="data-table" id="attendanceTable">
            <thead>
                <tr>
                    <th>Photographer</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Daily Rate</th>
                    <th>Earnings</th>
                    <th>Notes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="attendanceTableBody">
                <tr>
                    <td colspan="7" style="text-align: center; color: #666;">No attendance records found</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Expense Tracker Tab -->
<div id="expense-tracker" class="tab-content">
    <div class="form-section">
        <h3>Add Expense</h3>
        <form id="expenseForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="expenseDate">Date</label>
                    <input type="date" id="expenseDate" name="expenseDate" required>
                </div>
                <div class="form-group">
                    <label for="expenseCategory">Category</label>
                    <select id="expenseCategory" name="expenseCategory" required>
                        <option value="">Select Category</option>
                        <option value="Travel">Travel</option>
                        <option value="Equipment">Equipment</option>
                        <option value="Props">Props</option>
                        <option value="Food">Food</option>
                        <option value="Editing Tools">Editing Tools</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Miscellaneous">Miscellaneous</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="expenseDescription">Description</label>
                    <input type="text" id="expenseDescription" name="expenseDescription" required placeholder="Brief description">
                </div>
                <div class="form-group">
                    <label for="expenseAmount">Amount (₹)</label>
                    <input type="number" id="expenseAmount" name="expenseAmount" required>
                </div>
                <div class="form-group">
                    <label for="expensePaymentMode">Payment Mode</label>
                    <select id="expensePaymentMode" name="expensePaymentMode" required>
                        <option value="">Select Mode</option>
                        <option value="Cash">Cash</option>
                        <option value="UPI">UPI</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Credit Card">Credit Card</option>
                        <option value="Debit Card">Debit Card</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="expenseRemarks">Remarks</label>
                    <input type="text" id="expenseRemarks" name="expenseRemarks" placeholder="Optional remarks">
                </div>
            </div>
            <div class="action-buttons">
                <button type="submit" class="btn btn-primary">Add Expense</button>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('expenseForm').reset()">Clear</button>
            </div>
        </form>
    </div>

    <div class="form-section">
        <h3>Expense Records</h3>
        <div style="margin-bottom: 20px;">
            <select id="expenseFilterCategory" style="padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <option value="">All Categories</option>
                <option value="Travel">Travel</option>
                <option value="Equipment">Equipment</option>
                <option value="Props">Props</option>
                <option value="Food">Food</option>
                <option value="Editing Tools">Editing Tools</option>
                <option value="Marketing">Marketing</option>
                <option value="Miscellaneous">Miscellaneous</option>
            </select>
            <input type="month" id="expenseFilterMonth" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
        </div>
        <table class="data-table" id="expenseTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Payment Mode</th>
                    <th>Remarks</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="expenseTableBody">
                <tr>
                    <td colspan="7" style="text-align: center; color: #666;">No expense records found</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Salary Dashboard Tab -->
<div id="salary-dashboard" class="tab-content">
    <div class="stats-grid">
        <div class="stat-card">
            <h4>Total Salary Earned</h4>
            <div class="value" id="totalSalaryEarned">₹0</div>
        </div>
        <div class="stat-card">
            <h4>Total Salary Paid</h4>
            <div class="value" id="totalSalaryPaid">₹0</div>
        </div>
        <div class="stat-card">
            <h4>Outstanding Salary</h4>
            <div class="value" id="outstandingSalary">₹0</div>
        </div>
        <div class="stat-card">
            <h4>Total Expenses</h4>
            <div class="value" id="totalExpensesAmount">₹0</div>
        </div>
    </div>

    <div class="form-section">
        <h3>Photographer Salary Summary</h3>
        <table class="data-table" id="salaryDashboardTable">
            <thead>
                <tr>
                    <th>Photographer</th>
                    <th>Days Worked</th>
                    <th>Total Earned</th>
                    <th>Total Paid</th>
                    <th>Outstanding</th>
                    <th>Last Payment</th>
                </tr>
            </thead>
            <tbody id="salaryDashboardTableBody">
                <tr>
                    <td colspan="6" style="text-align: center; color: #666;">No salary data found</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="form-section">
        <h3>Monthly Expense Breakdown</h3>
        <div class="expense-breakdown" id="expenseBreakdown">
            <p style="text-align: center; color: #666;">No expense data found</p>
            </div>
         </div>
       </div>

        <div class="footer">
            <p>&copy; 2023 RN Studio. All rights reserved.</p>
        </div>
    </div>
</div>
<script>
    
        // Data storage
        let events = JSON.parse(localStorage.getItem('rn_studio_events')) || [];
        let photographers = JSON.parse(localStorage.getItem('rn_studio_photographers')) || [
            {id: 1, name: 'Self', contact: '', email: '', rate: 0}
        ];
        let attendanceRecords = JSON.parse(localStorage.getItem('rn_studio_attendance')) || [];
        let salaryPayments = JSON.parse(localStorage.getItem('rn_studio_salary_payments')) || [];
        let expenses = JSON.parse(localStorage.getItem('rn_studio_expenses')) || [];

        let isConnectedToSheets = false;
        let sheetsUrl = '';

        // Tab navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
            
            // Update data when switching tabs
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'events') {
                loadEvents();
            } else if (tabName === 'photographers') {
                loadPhotographers();
            } else if (tabName === 'analytics') {
                updateAnalytics();
            } else if (tabName === 'salary-management') {
                loadSalaryManagement();
            } else if (tabName === 'expense-tracker') {
                loadExpenseTracker();
            } else if (tabName === 'salary-dashboard') {
                loadSalaryDashboard();
            }
        }

        // Event form submission
        document.getElementById('eventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const eventData = {
                id: Date.now(),
                name: formData.get('eventName'),
                date: formData.get('eventDate'),
                prize: parseFloat(formData.get('eventPrize')),
                expenses: parseFloat(formData.get('eventExpenses')) || 0,
                photographer: formData.get('photographerName'),
                salary: parseFloat(formData.get('photographerSalary')) || 0,
                duration: parseInt(formData.get('eventDuration')),
                type: formData.get('eventType'),
                notes: formData.get('eventNotes'),
                profit: parseFloat(formData.get('eventPrize')) - (parseFloat(formData.get('eventExpenses')) || 0) - (parseFloat(formData.get('photographerSalary')) || 0)
            };
            
            events.push(eventData);
            saveDataLocally();
            
            // Auto-sync if connected
            if (isConnectedToSheets) {
                syncToGoogleSheets();
            }
            
            showNotification('Event added successfully!', 'success');
            clearForm();
            updateDashboard();
        });

        // Photographer form submission
        document.getElementById('photographerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const photographerData = {
                id: Date.now(),
                name: formData.get('photographerNameAdd'),
                contact: formData.get('photographerContact'),
                email: formData.get('photographerEmail'),
                rate: parseFloat(formData.get('photographerRate')) || 0
            };
            
            photographers.push(photographerData);
            saveDataLocally();
            
            // Auto-sync if connected
            if (isConnectedToSheets) {
                syncToGoogleSheets();
            }
            
            // Update photographer dropdown
            updatePhotographerDropdown();
            
            showNotification('Photographer added successfully!', 'success');
            document.getElementById('photographerForm').reset();
            loadPhotographers();
        });

          // Attendance form submission
        document.getElementById('attendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
    
            const formData = new FormData(e.target);
            const attendanceData = {
            id: Date.now(),
            photographer: formData.get('attendancePhotographer'),
            date: formData.get('attendanceDate'),
            status: formData.get('attendanceStatus'),
            notes: formData.get('attendanceNotes') || '',
            timestamp: new Date().toISOString()
    };
    
    attendanceRecords.push(attendanceData);
    saveDataLocally();
    
    // Auto-sync if connected
    if (isConnectedToSheets) {
        syncToGoogleSheets();
    }
    
    showNotification('Attendance marked successfully!', 'success');
    document.getElementById('attendanceForm').reset();
    loadAttendanceTable();
    loadSalaryDashboard();
});

// Salary payment form submission
document.getElementById('salaryPaymentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const paymentData = {
        id: Date.now(),
        photographer: formData.get('paymentPhotographer'),
        amount: parseFloat(formData.get('paymentAmount')),
        date: formData.get('paymentDate'),
        paymentMode: formData.get('paymentMode'),
        remarks: formData.get('paymentRemarks') || '',
        timestamp: new Date().toISOString()
    };
    
    salaryPayments.push(paymentData);
    saveDataLocally();
    
    // Auto-sync if connected
    if (isConnectedToSheets) {
        syncToGoogleSheets();
    }
    
    showNotification('Salary payment recorded successfully!', 'success');
    document.getElementById('salaryPaymentForm').reset();
    loadSalaryDashboard();
});

// Expense form submission
document.getElementById('expenseForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const expenseData = {
        id: Date.now(),
        date: formData.get('expenseDate'),
        category: formData.get('expenseCategory'),
        description: formData.get('expenseDescription'),
        amount: parseFloat(formData.get('expenseAmount')),
        paymentMode: formData.get('expensePaymentMode'),
        remarks: formData.get('expenseRemarks') || '',
        timestamp: new Date().toISOString()
    };
    
    expenses.push(expenseData);
    saveDataLocally();
    
    // Auto-sync if connected
    if (isConnectedToSheets) {
        syncToGoogleSheets();
    }
    
    showNotification('Expense added successfully!', 'success');
    document.getElementById('expenseForm').reset();
    loadExpenseTable();
    loadSalaryDashboard();
});

        // Save data to localStorage
        function saveDataLocally() {
            localStorage.setItem('rn_studio_events', JSON.stringify(events));
            localStorage.setItem('rn_studio_photographers', JSON.stringify(photographers));
            localStorage.setItem('rn_studio_attendance', JSON.stringify(attendanceRecords));
            localStorage.setItem('rn_studio_salary_payments', JSON.stringify(salaryPayments));
            localStorage.setItem('rn_studio_expenses', JSON.stringify(expenses));
        }

        // Update photographer dropdown
        function updatePhotographerDropdown() {
            const select = document.getElementById('photographerName');
            select.innerHTML = '<option value="">Select Photographer</option>';
            
            photographers.forEach(photographer => {
                const option = document.createElement('option');
                option.value = photographer.name;
                option.textContent = photographer.name;
                select.appendChild(option);
            });
        }

        // Load events table
        function loadEvents() {
            const tbody = document.getElementById('eventsTableBody');
            tbody.innerHTML = '';
            
            if (events.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #666;">No events found</td></tr>';
                return;
            }
            
            events.forEach(event => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${event.name}</td>
                    <td>${new Date(event.date).toLocaleDateString()}</td>
                    <td>${event.type}</td>
                    <td>₹${event.prize.toLocaleString()}</td>
                    <td>₹${event.expenses.toLocaleString()}</td>
                    <td>${event.photographer}</td>
                    <td>₹${event.salary.toLocaleString()}</td>
                    <td>${event.duration} days</td>
                    <td style="color: ${event.profit >= 0 ? 'green' : 'red'}">₹${event.profit.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteEvent(${event.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load photographers table
        function loadPhotographers() {
            const tbody = document.getElementById('photographersTableBody');
            tbody.innerHTML = '';
            
            if (photographers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">No photographers found</td></tr>';
                return;
            }
            
            photographers.forEach(photographer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${photographer.name}</td>
                    <td>${photographer.contact}</td>
                    <td>${photographer.email}</td>
                    <td>₹${photographer.rate.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deletePhotographer(${photographer.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update dashboard
        function updateDashboard() {
            const totalEvents = events.length;
            const totalRevenue = events.reduce((sum, event) => sum + event.prize, 0);
            const totalExpenses = events.reduce((sum, event) => sum + event.expenses + event.salary, 0);
            const netProfit = totalRevenue - totalExpenses;
            
            document.getElementById('totalEvents').textContent = totalEvents;
            document.getElementById('totalRevenue').textContent = '₹' + totalRevenue.toLocaleString();
            document.getElementById('totalExpenses').textContent = '₹' + totalExpenses.toLocaleString();
            document.getElementById('netProfit').textContent = '₹' + netProfit.toLocaleString();
            
            // Update recent events
            const recentEvents = events.slice(-5).reverse();
            const tbody = document.getElementById('recentEventsBody');
            tbody.innerHTML = '';
            
            if (recentEvents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">No events found</td></tr>';
            } else {
                recentEvents.forEach(event => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${event.name}</td>
                        <td>${new Date(event.date).toLocaleDateString()}</td>
                        <td>₹${event.prize.toLocaleString()}</td>
                        <td>${event.photographer}</td>
                        <td><span class="status-indicator status-connected">Completed</span></td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        // Update analytics
        function updateAnalytics() {
            const avgEventValue = events.length > 0 ? events.reduce((sum, event) => sum + event.prize, 0) / events.length : 0;
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthRevenue = events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear;
            }).reduce((sum, event) => sum + event.prize, 0);
            
            const eventTypes = {};
            events.forEach(event => {
                eventTypes[event.type] = (eventTypes[event.type] || 0) + 1;
            });
            
            const popularEventType = Object.keys(eventTypes).length > 0 ? 
                Object.keys(eventTypes).reduce((a, b) => eventTypes[a] > eventTypes[b] ? a : b) : '-';
            
            const totalEventDays = events.reduce((sum, event) => sum + event.duration, 0);
            
            document.getElementById('avgEventValue').textContent = '₹' + Math.round(avgEventValue).toLocaleString();
            document.getElementById('monthRevenue').textContent = '₹' + monthRevenue.toLocaleString();
            document.getElementById('popularEventType').textContent = popularEventType;
            document.getElementById('totalEventDays').textContent = totalEventDays;
        }

        function loadSalaryManagement() {
    updatePhotographerDropdowns();
    loadAttendanceTable();
    
    // Set default dates
    document.getElementById('attendanceDate').valueAsDate = new Date();
    document.getElementById('paymentDate').valueAsDate = new Date();
}

function updatePhotographerDropdowns() {
    const dropdowns = ['attendancePhotographer', 'paymentPhotographer', 'attendanceFilterPhotographer'];
    
    dropdowns.forEach(dropdownId => {
        const select = document.getElementById(dropdownId);
        const currentValue = select.value;
        select.innerHTML = dropdownId.includes('Filter') ? 
            '<option value="">All Photographers</option>' : 
            '<option value="">Select Photographer</option>';
        
        photographers.forEach(photographer => {
            if (photographer.name !== 'Self' || photographer.rate > 0) {
                const option = document.createElement('option');
                option.value = photographer.name;
                option.textContent = photographer.name;
                select.appendChild(option);
            }
        });
        
        select.value = currentValue;
    });
}

function loadAttendanceTable() {
    const tbody = document.getElementById('attendanceTableBody');
    tbody.innerHTML = '';
    
    if (attendanceRecords.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">No attendance records found</td></tr>';
        return;
    }
    
    const sortedRecords = attendanceRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    sortedRecords.forEach(record => {
        const photographer = photographers.find(p => p.name === record.photographer);
        const dailyRate = photographer ? photographer.rate : 0;
        let earnings = 0;
        
        if (record.status === 'Present') {
            earnings = dailyRate;
        } else if (record.status === 'Half-Day') {
            earnings = dailyRate / 2;
        }
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${record.photographer}</td>
            <td>${new Date(record.date).toLocaleDateString()}</td>
            <td><span class="status-indicator ${record.status === 'Present' ? 'status-connected' : record.status === 'Half-Day' ? 'status-warning' : 'status-disconnected'}">${record.status}</span></td>
            <td>₹${dailyRate.toLocaleString()}</td>
            <td>₹${earnings.toLocaleString()}</td>
            <td>${record.notes}</td>
            <td>
                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteAttendance(${record.id})">Delete</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

function loadExpenseTracker() {
    loadExpenseTable();
    
    // Set default date
    document.getElementById('expenseDate').valueAsDate = new Date();
}

function loadExpenseTable() {
    const tbody = document.getElementById('expenseTableBody');
    tbody.innerHTML = '';
    
    if (expenses.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">No expense records found</td></tr>';
        return;
    }
    
    const sortedExpenses = expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    sortedExpenses.forEach(expense => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${new Date(expense.date).toLocaleDateString()}</td>
            <td>${expense.category}</td>
            <td>${expense.description}</td>
            <td>₹${expense.amount.toLocaleString()}</td>
            <td>${expense.paymentMode}</td>
            <td>${expense.remarks}</td>
            <td>
                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteExpense(${expense.id})">Delete</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

function loadSalaryDashboard() {
    updateSalaryStats();
    loadSalaryDashboardTable();
    loadExpenseBreakdown();
}

function updateSalaryStats() {
    // Calculate total salary earned
    const totalEarned = attendanceRecords.reduce((sum, record) => {
        const photographer = photographers.find(p => p.name === record.photographer);
        const dailyRate = photographer ? photographer.rate : 0;
        
        if (record.status === 'Present') {
            return sum + dailyRate;
        } else if (record.status === 'Half-Day') {
            return sum + (dailyRate / 2);
        }
        return sum;
    }, 0);
    
    // Calculate total salary paid
    const totalPaid = salaryPayments.reduce((sum, payment) => sum + payment.amount, 0);
    
    // Calculate outstanding salary
    const outstanding = totalEarned - totalPaid;
    
    // Calculate total expenses
    const totalExpensesAmount = expenses.reduce((sum, expense) => sum + expense.amount, 0);
    
    document.getElementById('totalSalaryEarned').textContent = '₹' + totalEarned.toLocaleString();
    document.getElementById('totalSalaryPaid').textContent = '₹' + totalPaid.toLocaleString();
    document.getElementById('outstandingSalary').textContent = '₹' + outstanding.toLocaleString();
    document.getElementById('totalExpensesAmount').textContent = '₹' + totalExpensesAmount.toLocaleString();
}

function loadSalaryDashboardTable() {
    const tbody = document.getElementById('salaryDashboardTableBody');
    tbody.innerHTML = '';
    
    const photographerSummary = {};
    
    // Calculate earnings for each photographer
    attendanceRecords.forEach(record => {
        if (!photographerSummary[record.photographer]) {
            photographerSummary[record.photographer] = {
                name: record.photographer,
                daysWorked: 0,
                totalEarned: 0,
                totalPaid: 0,
                lastPayment: null
            };
        }
        
        const photographer = photographers.find(p => p.name === record.photographer);
        const dailyRate = photographer ? photographer.rate : 0;
        
        if (record.status === 'Present') {
            photographerSummary[record.photographer].daysWorked += 1;
            photographerSummary[record.photographer].totalEarned += dailyRate;
        } else if (record.status === 'Half-Day') {
            photographerSummary[record.photographer].daysWorked += 0.5;
            photographerSummary[record.photographer].totalEarned += (dailyRate / 2);
        }
    });
    
    // Calculate payments for each photographer
    salaryPayments.forEach(payment => {
        if (photographerSummary[payment.photographer]) {
            photographerSummary[payment.photographer].totalPaid += payment.amount;
            if (!photographerSummary[payment.photographer].lastPayment || 
                new Date(payment.date) > new Date(photographerSummary[payment.photographer].lastPayment)) {
                photographerSummary[payment.photographer].lastPayment = payment.date;
            }
        }
    });
    
    if (Object.keys(photographerSummary).length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">No salary data found</td></tr>';
        return;
    }
    
    Object.values(photographerSummary).forEach(summary => {
        const outstanding = summary.totalEarned - summary.totalPaid;
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${summary.name}</td>
            <td>${summary.daysWorked}</td>
            <td>₹${summary.totalEarned.toLocaleString()}</td>
            <td>₹${summary.totalPaid.toLocaleString()}</td>
            <td style="color: ${outstanding > 0 ? 'red' : 'green'}">₹${outstanding.toLocaleString()}</td>
            <td>${summary.lastPayment ? new Date(summary.lastPayment).toLocaleDateString() : 'Never'}</td>
        `;
        tbody.appendChild(row);
    });
}

function loadExpenseBreakdown() {
    const breakdownDiv = document.getElementById('expenseBreakdown');
    
    if (expenses.length === 0) {
        breakdownDiv.innerHTML = '<p style="text-align: center; color: #666;">No expense data found</p>';
        return;
    }
    
    const categoryTotals = {};
    expenses.forEach(expense => {
        categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
    });
    
    const totalExpenses = Object.values(categoryTotals).reduce((sum, amount) => sum + amount, 0);
    
    let html = '<div class="expense-breakdown-grid">';
    Object.entries(categoryTotals).forEach(([category, amount]) => {
        const percentage = ((amount / totalExpenses) * 100).toFixed(1);
        html += `
            <div class="expense-category">
                <div class="category-header">
                    <span class="category-name">${category}</span>
                    <span class="category-amount">₹${amount.toLocaleString()}</span>
                </div>
                <div class="category-bar">
                    <div class="category-progress" style="width: ${percentage}%"></div>
                </div>
                <div class="category-percentage">${percentage}%</div>
            </div>
        `;
    });
    html += '</div>';
    
    breakdownDiv.innerHTML = html;
}

// Delete functions
function deleteAttendance(id) {
    if (confirm('Are you sure you want to delete this attendance record?')) {
        attendanceRecords = attendanceRecords.filter(record => record.id !== id);
        saveDataLocally();
        loadAttendanceTable();
        loadSalaryDashboard();
        showNotification('Attendance record deleted successfully!', 'success');
    }
}

function deleteExpense(id) {
    if (confirm('Are you sure you want to delete this expense record?')) {
        expenses = expenses.filter(expense => expense.id !== id);
        saveDataLocally();
        loadExpenseTable();
        loadSalaryDashboard();
        showNotification('Expense record deleted successfully!', 'success');
    }
}


        // Utility functions
        function clearForm() {
            document.getElementById('eventForm').reset();
        }

        function deleteEvent(id) {
            if (confirm('Are you sure you want to delete this event?')) {
                events = events.filter(event => event.id !== id);
                localStorage.setItem('rn_studio_events', JSON.stringify(events));
                loadEvents();
                updateDashboard();
            }
        }

        function deletePhotographer(id) {
            if (confirm('Are you sure you want to delete this photographer?')) {
                photographers = photographers.filter(photographer => photographer.id !== id);
                localStorage.setItem('rn_studio_photographers', JSON.stringify(photographers));
                updatePhotographerDropdown();
                loadPhotographers();
            }
        }

        // Search and filter functions
        document.getElementById('searchEvents').addEventListener('input', function() {
            filterEvents();
        });

        document.getElementById('filterType').addEventListener('change', function() {
            filterEvents();
        });

        function filterEvents() {
            const searchTerm = document.getElementById('searchEvents').value.toLowerCase();
            const filterType = document.getElementById('filterType').value;
            
            let filteredEvents = events;
            
            if (searchTerm) {
                filteredEvents = filteredEvents.filter(event => 
                    event.name.toLowerCase().includes(searchTerm) ||
                    event.photographer.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filterType) {
                filteredEvents = filteredEvents.filter(event => event.type === filterType);
            }
            
            displayFilteredEvents(filteredEvents);
        }

        function displayFilteredEvents(filteredEvents) {
            const tbody = document.getElementById('eventsTableBody');
            tbody.innerHTML = '';
            
            if (filteredEvents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #666;">No events found</td></tr>';
                return;
            }
            
            filteredEvents.forEach(event => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${event.name}</td>
                    <td>${new Date(event.date).toLocaleDateString()}</td>
                    <td>${event.type}</td>
                    <td>₹${event.prize.toLocaleString()}</td>
                    <td>₹${event.expenses.toLocaleString()}</td>
                    <td>${event.photographer}</td>
                    <td>₹${event.salary.toLocaleString()}</td>
                    <td>${event.duration} days</td>
                    <td style="color: ${event.profit >= 0 ? 'green' : 'red'}">₹${event.profit.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteEvent(${event.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        //search && filter option for Attendance
        document.getElementById('attendanceFilterPhotographer').addEventListener('input', function() {
            filterAttendance();
        });

        document.getElementById('attendanceFilterPhotographer').addEventListener('change', function() {
            filterAttendance();
        });

        function filterAttendance() {
            const searchTerm = document.getElementById('attendanceFilterPhotographer').value.toLowerCase();
            const filteredRecords = attendanceRecords.filter(record => 
                record.photographer.toLowerCase().includes(searchTerm)
            );
            displayFilteredAttendance(filteredRecords);
        }

        function displayFilteredAttendance(filteredRecords) {
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';
            
            if (filteredRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">No attendance records found</td></tr>';
                return;
            }
            
            filteredRecords.forEach(record => {
                const photographer = photographers.find(p => p.name === record.photographer);
                const dailyRate = photographer ? photographer.rate : 0;
                let earnings = 0;
                
                if (record.status === 'Present') {
                    earnings = dailyRate;
                } else if (record.status === 'Half-Day') {
                    earnings = dailyRate / 2;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.photographer}</td>
                    <td>${new Date(record.date).toLocaleDateString()}</td>
                    <td><span class="status-indicator ${record.status === 'Present' ? 'status-connected' : record.status === 'Half-Day' ? 'status-warning' : 'status-disconnected'}">${record.status}</span></td>
                    <td>₹${dailyRate.toLocaleString()}</td>
                    <td>₹${earnings.toLocaleString()}</td>
                    <td>${record.notes}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteAttendance(${record.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        //Search & Filter Option for Expense Record
        document.getElementById('expenseFilterCategory').addEventListener('input', function() {
            filterExpense();
        });

        document.getElementById('expenseFilterCategory').addEventListener('change', function() {
            filterExpense();
        });

        function filterExpense() {
            const searchTerm = document.getElementById('expenseFilterCategory').value.toLowerCase();
            const filteredExpenses = expenses.filter(expense => 
                expense.category.toLowerCase().includes(searchTerm)
            );
            displayFilteredExpenses(filteredExpenses);
        }

        function displayFilteredExpenses(filteredExpenses) {
            const tbody = document.getElementById('expenseTableBody');
            tbody.innerHTML = '';
            
            if (filteredExpenses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">No expense records found</td></tr>';
                return;
            }
            
            filteredExpenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(expense.date).toLocaleDateString()}</td>
                    <td>${expense.category}</td>
                    <td>${expense.description}</td>
                    <td>₹${expense.amount.toLocaleString()}</td>
                    <td>${expense.paymentMode}</td>
                    <td>${expense.remarks}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteExpense(${expense.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }


        // Google Sheets integration
        function connectGoogleSheets() {
    const url = document.getElementById('googleSheetUrl').value;
    if (!url) {
        alert('Please enter the Google Apps Script URL');
        return;
    }
    
    // Store the URL
    localStorage.setItem('rn_studio_sheets_url', url);
    sheetsUrl = url;
    
    // First check if data already exists in sheets
    checkSheetsData().then(hasData => {
        if (hasData) {
            // Data exists in sheets, ask user what to do
            const choice = confirm(
                'Data already exists in Google Sheets. Click OK to load data from sheets, or Cancel to upload your local data to sheets.'
            );
            
            if (choice) {
                // Load from sheets
                loadFromGoogleSheets();
            } else {
                // Upload local data to sheets
                uploadLocalDataToSheets();
            }
        } else {
            // No data in sheets, upload local data
            uploadLocalDataToSheets();
        }
        
        // Update UI
        updateConnectionStatus(true);
    }).catch(error => {
        console.error('Error connecting to Google Sheets:', error);
        // Still mark as connected for sync purposes
        updateConnectionStatus(true);
        // Upload local data as fallback
        uploadLocalDataToSheets();
    });
}
function checkSheetsData() {
    return new Promise((resolve, reject) => {
        const url = localStorage.getItem('rn_studio_sheets_url');
        if (!url) {
            reject('No URL configured');
            return;
        }
        
        const callback = 'checkDataCallback' + Date.now();
        
        // Create JSONP callback
        window[callback] = function(data) {
            resolve(data.hasData);
            delete window[callback];
            document.body.removeChild(script);
        };
        
        // Create script tag for JSONP
        const script = document.createElement('script');
        script.src = url + '?action=checkData&callback=' + callback;
        script.onerror = () => {
            reject('Failed to check sheets data');
            delete window[callback];
            document.body.removeChild(script);
        };
        
        document.body.appendChild(script);
    });
}

function updateConnectionStatus(connected) {
    const statusElement = document.getElementById('connectionStatus');
    const manualSyncBtn = document.getElementById('manualSyncBtn');
    const loadFromSheetsBtn = document.getElementById('loadFromSheetsBtn');
    
    if (connected) {
        statusElement.textContent = 'Connected';
        statusElement.className = 'status-indicator status-connected';
        manualSyncBtn.disabled = false;
        loadFromSheetsBtn.disabled = false;
        isConnectedToSheets = true;
        showNotification('Connected to Google Sheets successfully!', 'success');
    } else {
        statusElement.textContent = 'Disconnected';
        statusElement.className = 'status-indicator status-disconnected';
        manualSyncBtn.disabled = true;
        loadFromSheetsBtn.disabled = true;
        isConnectedToSheets = false;
    }
}

function uploadLocalDataToSheets() {
    if (events.length === 0 && photographers.length <= 1 && attendanceRecords.length === 0 && salaryPayments.length === 0 && expenses.length === 0) {
        showNotification('No local data to upload', 'info');
        return;
    }
    
    showNotification('Uploading local data to Google Sheets...', 'info');
    syncToGoogleSheets(false, true); // false = no manual notification, true = initial upload
}

        // Data management functions
       function exportData() {
    const data = {
        events: events,
        photographers: photographers,
        attendanceRecords: attendanceRecords,
        salaryPayments: salaryPayments,
        expenses: expenses,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const exportFileDefaultName = 'rn_studio_backup_' + new Date().toISOString().split('T')[0] + '.json';
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
}

// Update the importData function to handle new data
function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.events && data.photographers) {
                    if (confirm('This will replace all current data. Are you sure?')) {
                        events = data.events;
                        photographers = data.photographers;
                        attendanceRecords = data.attendanceRecords || [];
                        salaryPayments = data.salaryPayments || [];
                        expenses = data.expenses || [];
                        
                        saveDataLocally();
                        updatePhotographerDropdown();
                        updateDashboard();
                        loadEvents();
                        loadPhotographers();
                        loadSalaryManagement();
                        loadExpenseTracker();
                        loadSalaryDashboard();
                        
                        showNotification('Data imported successfully!', 'success');
                    }
                } else {
                    alert('Invalid backup file format.');
                }
            } catch (error) {
                alert('Error reading backup file.');
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

// Update the clearAllData function to include new data
function clearAllData() {
    if (confirm('This will permanently delete all your data. Are you sure?')) {
        if (confirm('Last chance! This action cannot be undone.')) {
            events = [];
            photographers = [{id: 1, name: 'Self', contact: '', email: '', rate: 0}];
            attendanceRecords = [];
            salaryPayments = [];
            expenses = [];
            
            saveDataLocally();
            updatePhotographerDropdown();
            updateDashboard();
            loadEvents();
            loadPhotographers();
            loadSalaryManagement();
            loadExpenseTracker();
            loadSalaryDashboard();
            
            showNotification('All data cleared successfully!', 'success');
        }
    }
}
        // Update the syncToGoogleSheets function to include new data
function syncToGoogleSheets(manual = false, initialUpload = false) {
    const url = localStorage.getItem('rn_studio_sheets_url');
    if (!url) {
        if (manual) {
            showNotification('Google Sheets not configured', 'error');
        }
        return;
    }
    
    // Create hidden iframe to prevent page navigation
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.name = 'syncFrame';
    document.body.appendChild(iframe);
    
    // Use form submission to hidden iframe
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = url;
    form.target = 'syncFrame';
    form.style.display = 'none';
    
    const actionInput = document.createElement('input');
    actionInput.type = 'hidden';
    actionInput.name = 'action';
    actionInput.value = 'sync';
    form.appendChild(actionInput);
    
    const eventsInput = document.createElement('input');
    eventsInput.type = 'hidden';
    eventsInput.name = 'events';
    eventsInput.value = JSON.stringify(events);
    form.appendChild(eventsInput);
    
    const photographersInput = document.createElement('input');
    photographersInput.type = 'hidden';
    photographersInput.name = 'photographers';
    photographersInput.value = JSON.stringify(photographers);
    form.appendChild(photographersInput);
    
    // Add new data inputs
    const attendanceInput = document.createElement('input');
    attendanceInput.type = 'hidden';
    attendanceInput.name = 'attendanceRecords';
    attendanceInput.value = JSON.stringify(attendanceRecords);
    form.appendChild(attendanceInput);
    
    const salaryInput = document.createElement('input');
    salaryInput.type = 'hidden';
    salaryInput.name = 'salaryPayments';
    salaryInput.value = JSON.stringify(salaryPayments);
    form.appendChild(salaryInput);
    
    const expensesInput = document.createElement('input');
    expensesInput.type = 'hidden';
    expensesInput.name = 'expenses';
    expensesInput.value = JSON.stringify(expenses);
    form.appendChild(expensesInput);
    
    document.body.appendChild(form);
    form.submit();
    
    // Clean up after a delay
    setTimeout(() => {
        if (document.body.contains(form)) document.body.removeChild(form);
        if (document.body.contains(iframe)) document.body.removeChild(iframe);
    }, 2000);
    
    // Show appropriate notification
    if (manual) {
        showNotification('Data synced to Google Sheets!', 'success');
    } else if (initialUpload) {
        showNotification('Local data uploaded to Google Sheets!', 'success');
    }
}

        // Auto-sync when data changes
        function saveAndSync() {
            localStorage.setItem('rn_studio_events', JSON.stringify(events));
            localStorage.setItem('rn_studio_photographers', JSON.stringify(photographers));
            localStorage.setItem('rn_studio_attendance', JSON.stringify(attendanceRecords));
            localStorage.setItem('rn_studio_salary_payments', JSON.stringify(salaryPayments));
            localStorage.setItem('rn_studio_expenses', JSON.stringify(expenses));
            syncToGoogleSheets();
        }

        // Enhanced form validation
        document.getElementById('eventForm').addEventListener('input', function(e) {
            const target = e.target;
            if (target.name === 'photographerName' && target.value) {
                const photographer = photographers.find(p => p.name === target.value);
                if (photographer && photographer.rate > 0) {
                    document.getElementById('photographerSalary').value = photographer.rate;
                }
            }
        });


        // Load data from Google Sheets
function loadFromGoogleSheets() {
    return new Promise((resolve, reject) => {
        const url = localStorage.getItem('rn_studio_sheets_url');
        if (!url) {
            reject('Google Sheets not configured');
            return;
        }
        
        const callback = 'loadDataCallback' + Date.now();
        
        // Create JSONP callback
        window[callback] = function(data) {
            try {
                if (data.events && data.photographers) {
                    events = data.events;
                    photographers = data.photographers;
                    attendanceRecords = data.attendanceRecords || [];
                    salaryPayments = data.salaryPayments || [];
                    expenses = data.expenses || [];
                    
                    saveDataLocally();
                    updatePhotographerDropdown();
                    updateDashboard();
                    loadEvents();
                    loadPhotographers();
                    loadSalaryManagement();
                    loadExpenseTracker();
                    loadSalaryDashboard();
                    
                    showNotification('Data loaded from Google Sheets successfully!', 'success');
                    resolve(data);
                } else {
                    reject('Invalid data format');
                }
            } catch (error) {
                reject('Error processing data: ' + error.message);
            }
            
            delete window[callback];
            document.body.removeChild(script);
        };
        
        // Create script tag for JSONP
        const script = document.createElement('script');
        script.src = url + '?action=load&callback=' + callback;
        script.onerror = () => {
            reject('Failed to load data from Google Sheets');
            delete window[callback];
            if (document.body.contains(script)) {
                document.body.removeChild(script);
            }
        };
        
        document.body.appendChild(script);
    });
}

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'n':
                        e.preventDefault();
                        showTab('add-event');
                        break;
                    case 'e':
                        e.preventDefault();
                        exportData();
                        break;
                    case 's':
                        e.preventDefault();
                        syncToGoogleSheets();
                        break;
                }
            }
        });

function initializeApp() {
    updatePhotographerDropdown();
    updateDashboard();
    
    // Check for Google Sheets connection
    const storedSheetsUrl = localStorage.getItem('rn_studio_sheets_url');
    if (storedSheetsUrl) {
        document.getElementById('googleSheetUrl').value = storedSheetsUrl;
        sheetsUrl = storedSheetsUrl;
        updateConnectionStatus(true);
        
        // Don't automatically load from sheets on startup
        // Let user decide when to sync
        console.log('Google Sheets URL found, ready for manual sync');
    }
}
        // Auto-save every 5 minutes (300000 ms) - less annoying
setInterval(() => {
    localStorage.setItem('rn_studio_events', JSON.stringify(events));
    localStorage.setItem('rn_studio_photographers', JSON.stringify(photographers));
    localStorage.setItem('rn_studio_attendance', JSON.stringify(attendanceRecords));
    localStorage.setItem('rn_studio_expenses', JSON.stringify(expenses));
    localStorage.setItem('rn_studio_salary_payments', JSON.stringify(salaryPayments));
    syncToGoogleSheets(); // No notification for auto-sync
}, 300000);

        // Initialize when page loads
        window.addEventListener('load', initializeApp);
        
        // Handle page unload
        window.addEventListener('beforeunload', function() {
            saveAndSync();
        });

        // Add notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                opacity: 0;
                transform: translateY(-20px);
                transition: all 0.3s ease;
                ${type === 'success' ? 'background: #28a745;' : 
            type === 'error' ? 'background: #dc3545;' :'background: #17a2b8;'} `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateY(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e);
            showNotification('An error occurred. Please try again.', 'error');
        });
        
        // Service worker registration for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }
        // Disconnect Google Sheets
        function disconnectGoogleSheets() {
    if (confirm('Are you sure you want to disconnect from Google Sheets?')) {
        localStorage.removeItem('rn_studio_sheets_url');
        sheetsUrl = '';
        document.getElementById('googleSheetUrl').value = '';
        updateConnectionStatus(false);
        showNotification('Disconnected from Google Sheets', 'info');
    }
}
</script>
<script>
// Mobile Navigation Functions
function toggleMobileNav() {
    const navTabs = document.getElementById('navTabs');
    const mobileToggle = document.querySelector('.mobile-nav-toggle');
    const overlay = document.querySelector('.mobile-overlay');
    
    navTabs.classList.toggle('mobile-open');
    mobileToggle.classList.toggle('active');
    overlay.classList.toggle('active');
    
    // Prevent body scroll when menu is open
    if (navTabs.classList.contains('mobile-open')) {
        document.body.style.overflow = 'hidden';
    } else {
        document.body.style.overflow = '';
    }
}

function closeMobileNav() {
    const navTabs = document.getElementById('navTabs');
    const mobileToggle = document.querySelector('.mobile-nav-toggle');
    const overlay = document.querySelector('.mobile-overlay');
    
    navTabs.classList.remove('mobile-open');
    mobileToggle.classList.remove('active');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
}

// Enhanced showTab function that closes mobile menu
function showTab(tabName) {
    // Hide all tab contents
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => content.classList.remove('active'));
    
    // Remove active class from all nav tabs
    const navTabs = document.querySelectorAll('.nav-tab');
    navTabs.forEach(tab => tab.classList.remove('active'));
    
    // Show selected tab content
    document.getElementById(tabName).classList.add('active');
    
    // Add active class to clicked nav tab
    event.target.classList.add('active');
    
    // Close mobile menu when tab is selected
    if (window.innerWidth <= 768) {
        closeMobileNav();
    }
}

// Swipe gesture support for mobile
let touchStartX = 0;
let touchStartY = 0;
let touchEndX = 0;
let touchEndY = 0;

function handleTouchStart(event) {
    touchStartX = event.changedTouches[0].screenX;
    touchStartY = event.changedTouches[0].screenY;
}

function handleTouchEnd(event) {
    touchEndX = event.changedTouches[0].screenX;
    touchEndY = event.changedTouches[0].screenY;
    handleSwipe();
}

function handleSwipe() {
    const swipeThreshold = 50;
    const swipeDistance = touchEndX - touchStartX;
    const verticalDistance = Math.abs(touchEndY - touchStartY);
    
    // Only trigger swipe if horizontal movement is greater than vertical
    if (Math.abs(swipeDistance) > verticalDistance) {
        const navTabs = document.getElementById('navTabs');
        
        // Swipe from left edge to open menu
        if (swipeDistance > swipeThreshold && touchStartX < 50 && !navTabs.classList.contains('mobile-open')) {
            toggleMobileNav();
        }
        
        // Swipe right to left to close menu
        if (swipeDistance < -swipeThreshold && navTabs.classList.contains('mobile-open')) {
            closeMobileNav();
        }
    }
}

// Keyboard navigation support
function handleKeyDown(event) {
    const navTabs = document.getElementById('navTabs');
    
    // Close menu on Escape key
    if (event.key === 'Escape' && navTabs.classList.contains('mobile-open')) {
        closeMobileNav();
    }
    
    // Toggle menu on Enter/Space when hamburger is focused
    if ((event.key === 'Enter' || event.key === ' ') && 
        document.activeElement.classList.contains('mobile-nav-toggle')) {
        event.preventDefault();
        toggleMobileNav();
    }
}

// Resize handler to ensure proper behavior on orientation change
function handleResize() {
    if (window.innerWidth > 768) {
        closeMobileNav();
    }
}

// Initialize event listeners when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Touch events for swipe gestures
    document.addEventListener('touchstart', handleTouchStart, false);
    document.addEventListener('touchend', handleTouchEnd, false);
    
    // Keyboard navigation
    document.addEventListener('keydown', handleKeyDown);
    
    // Resize handler
    window.addEventListener('resize', handleResize);
    
    // Make hamburger button focusable for keyboard navigation
    const mobileToggle = document.querySelector('.mobile-nav-toggle');
    if (mobileToggle) {
        mobileToggle.setAttribute('tabindex', '0');
        mobileToggle.setAttribute('aria-label', 'Toggle navigation menu');
        mobileToggle.setAttribute('aria-expanded', 'false');
    }
    
    // Update aria-expanded attribute when menu state changes
    const originalToggleFunction = window.toggleMobileNav;
    window.toggleMobileNav = function() {
        originalToggleFunction();
        const navTabs = document.getElementById('navTabs');
        const mobileToggle = document.querySelector('.mobile-nav-toggle');
        
        if (mobileToggle) {
            mobileToggle.setAttribute('aria-expanded', 
                navTabs.classList.contains('mobile-open') ? 'true' : 'false');
        }
    };
    
    // Smooth scrolling prevention during menu animation
    const navTabs = document.getElementById('navTabs');
    if (navTabs) {
        navTabs.addEventListener('transitionstart', function() {
            if (window.innerWidth <= 768) {
                document.body.style.overflow = 'hidden';
            }
        });
        
        navTabs.addEventListener('transitionend', function() {
            if (!navTabs.classList.contains('mobile-open')) {
                document.body.style.overflow = '';
            }
        });
    }
    
    // Enhanced tab switching with smooth transitions
    const navButtons = document.querySelectorAll('.nav-tab');
    navButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const tabName = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            showTab(tabName);
        });
    });
    
    // Auto-close menu when clicking outside on mobile
    document.addEventListener('click', function(event) {
        const navTabs = document.getElementById('navTabs');
        const mobileToggle = document.querySelector('.mobile-nav-toggle');
        
        if (window.innerWidth <= 768 && 
            navTabs.classList.contains('mobile-open') && 
            !navTabs.contains(event.target) && 
            !mobileToggle.contains(event.target)) {
            closeMobileNav();
        }
    });
    
    // Prevent menu from staying open on orientation change
    window.addEventListener('orientationchange', function() {
        setTimeout(function() {
            if (window.innerWidth > 768) {
                closeMobileNav();
            }
        }, 100);
    });
    
    // Performance optimization: debounce resize events
    let resizeTimeout;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(handleResize, 150);
    });
});

// Additional utility functions for enhanced UX
function isMobileMenuOpen() {
    return document.getElementById('navTabs').classList.contains('mobile-open');
}

function getMobileBreakpoint() {
    return 768;
}

function isMobileView() {
    return window.innerWidth <= getMobileBreakpoint();
}

// Focus management for accessibility
function trapFocus(element) {
    const focusableElements = element.querySelectorAll(
        'a, button, textarea, input, select, [tabindex]:not([tabindex="-1"])'
    );
    
    if (focusableElements.length === 0) return;
    
    const firstFocusable = focusableElements[0];
    const lastFocusable = focusableElements[focusableElements.length - 1];
    
    element.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
            if (e.shiftKey) {
                if (document.activeElement === firstFocusable) {
                    lastFocusable.focus();
                    e.preventDefault();
                }
            } else {
                if (document.activeElement === lastFocusable) {
                    firstFocusable.focus();
                    e.preventDefault();
                }
            }
        }
    });
}

// Initialize focus trap when menu opens
document.addEventListener('DOMContentLoaded', function() {
    const navTabs = document.getElementById('navTabs');
    
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                if (navTabs.classList.contains('mobile-open')) {
                    trapFocus(navTabs);
                    // Focus first menu item for better accessibility
                    const firstMenuItem = navTabs.querySelector('.nav-tab');
                    if (firstMenuItem) {
                        setTimeout(() => firstMenuItem.focus(), 100);
                    }
                }
            }
        });
    });
    
    observer.observe(navTabs, {
        attributes: true,
        attributeFilter: ['class']
    });
});
    </script>

    </div>
</body>
</html>
